# Java – Try with Resources

## 1. 概述
Java 7中引入的对try-with-resources的支持使我们能够声明将在try块中使用的资源，并确保在执行该块后将关闭资源。

声明的资源必须实现AutoCloseable接口。

## 2. 使用try-with-resources
简而言之，要自动关闭，必须在try内声明和初始化资源，如下所示：

```java
try (PrintWriter writer = new PrintWriter(new File("test.txt"))) {
    writer.println("Hello World");
}
```

## 3. 用try-with-resources替换try-catch-finally
使用新的try-with-resources功能的简单明了的方法是替换传统的冗长的try-catch-finally块。

让我们比较以下代码示例–首先是一个典型的try-catch-finally块，然后是新方法，使用等效的try-with-resources块：

```java
Scanner scanner = null;
try {
    scanner = new Scanner(new File("test.txt"));
    while (scanner.hasNext()) {
        System.out.println(scanner.nextLine());
    }
} catch (FileNotFoundException e) {
    e.printStackTrace();
} finally {
    if (scanner != null) {
        scanner.close();
    }
}
```

这是使用try-with-resources的超级简洁解决方案：

```java
try (Scanner scanner = new Scanner(new File("test.txt"))) {
    while (scanner.hasNext()) {
        System.out.println(scanner.nextLine());
    }
} catch (FileNotFoundException fnfe) {
    fnfe.printStackTrace();
}
```

在这里您可以进一步探索Scanner类。

## 4. try-with-resources具有多个资源
通过用分号分隔多个资源，可以在try-with-resources块中声明多个资源，用分号隔开

```java
try (Scanner scanner = new Scanner(new File("testRead.txt"));
     PrintWriter writer = new PrintWriter(new File("testWrite.txt"))) {
    while (scanner.hasNext()) {
        writer.print(scanner.nextLine());
    }
}
```

## 5. 具有自动关闭功能的自定义资源
要构造一个将由try-with-resources块正确处理的自定义资源，该类应实现Closeable或AutoCloseable接口，并重写close方法：

```java
public class MyResource implements AutoCloseable {
    @Override
    public void close() throws Exception {
        System.out.println("Closed MyResource");
    }
}
```

## 6. 资源关闭顺序
首先定义/获取的资源将最后关闭；让我们看一下这种行为的一个例子：

资源1：

```java
public class AutoCloseableResourcesFirst implements AutoCloseable {

    public AutoCloseableResourcesFirst() {
        System.out.println("Constructor -> AutoCloseableResources_First");
    }

    public void doSomething() {
        System.out.println("Something -> AutoCloseableResources_First");
    }

    @Override
    public void close() throws Exception {
        System.out.println("Closed AutoCloseableResources_First");
    }
}
```
资源2：

```java
public class AutoCloseableResourcesSecond implements AutoCloseable {
    public AutoCloseableResourcesSecond() {
        System.out.println("Constructor -> AutoCloseableResources_Second");
    }

    public void doSomething() {
        System.out.println("Something -> AutoCloseableResources_Second");
    }

    @Override
    public void close() throws Exception {
        System.out.println("Closed AutoCloseableResources_Second");
    }
}
```

码：

```java
@Test
public  void testTryWithResourceOrder() throws Exception {
    orderOfClosingResources();
}

private static void orderOfClosingResources() throws Exception {
    try (AutoCloseableResourcesFirst af = new AutoCloseableResourcesFirst();
         AutoCloseableResourcesSecond as = new AutoCloseableResourcesSecond()) {
        af.doSomething();
        as.doSomething();
    }
}
```
输出：

```
Constructor -> AutoCloseableResources_First
Constructor -> AutoCloseableResources_Second
Something -> AutoCloseableResources_First
Something -> AutoCloseableResources_Second
Closed AutoCloseableResources_Second
Closed AutoCloseableResources_First
```

## 7. catch & finally
一个try-with-resources块仍然可以包含catch和finally块-它将以与传统try块相同的方式工作。

## 8. 结论
在本文中，我们讨论了如何使用try-with-resources，如何用try-with-resources替换try，catch和finally，如何使用AutoCloseable构建自定义资源以及关闭资源的顺序。

该示例的完整源代码可[在此GitHub项目中](https://github.com/tomlxq/tutorials/tree/master/core-java-modules/core-java-exceptions-2)找到。

